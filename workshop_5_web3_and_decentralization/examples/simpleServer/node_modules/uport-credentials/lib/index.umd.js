!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("elliptic"),require("uport-did-resolver"),require("ethr-did-resolver"),require("https-did-resolver"),require("uport-lite"),require("mnid"),require("did-jwt")):"function"==typeof define&&define.amd?define(["exports","elliptic","uport-did-resolver","ethr-did-resolver","https-did-resolver","uport-lite","mnid","did-jwt"],r):r(e.uportCredentials={},e.elliptic,e.UportDIDResolver,e.EthrDIDResolver,e.HttpsDIDResolver,e.UportLite,e.mnid,e.didJwt)}(this,function(e,r,t,i,n,o,a,s){var c,u;t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o,function(e){e.Function="function",e.Event="event",e.Constructor="constructor",e.Fallback="fallback"}(c||(c={})),function(e){e.Pure="pure",e.View="view",e.NonPayable="nonpayable",e.Payable="payable"}(u||(u={}));var d,l=function(e,r){for(var t=e.name+"(",i=e.inputs||[],n=0;n<i.length;n++){var o=i[n],a=o.type+" ";t+=a+="string"===o.type?'"'+r[n]+'"':""+r[n],i.length-1!==n&&(t+=", ")}return t+")"},p=function(e){return function(r){return{at:function(t){var i={};return function(e){return e.filter(function(e){return e.type===c.Function&&e.name&&!e.constant})}(r).forEach(function(r){r.name&&(i[r.name]=function(){var i={},n=[].slice.call(arguments),o=(r.inputs||[]).length;(function(e){if("object"!=typeof e)return!1;if(0===Object.keys(e).length)return!0;for(var r=0,t=["from","to","data","value","gasPrice","gas"];r<t.length;r+=1)if(t[r]in e)return!0;return!1})(n[o])&&(i=n.splice(o,1)[0]);var a=Object.assign({},i,{to:t,function:l(r,n)});return e?e(a,n[n.length-1]):a})}),Object.assign({},i,{abi:r,address:t})}}}},f=new r.ec("secp256k1");!function(e){e.DISCLOSURE_REQUEST="shareReq",e.DISCLOSURE_RESPONSE="shareResp",e.TYPED_DATA_SIGNATURE_REQUEST="eip712Req",e.VERIFICATION_SIGNATURE_REQUEST="verReq",e.ETH_TX_REQUEST="ethtx",e.PERSONAL_SIGN_REQUEST="personalSigReq"}(d||(d={}));var v=function(e){var r,c=e.did,u=e.address,d=e.privateKey,l=e.signer,p=e.networks,v=e.registry,h=e.ethrConfig;if(l?this.signer=l:d&&(this.signer=s.SimpleSigner(d)),c)this.did=c;else if(u)a.isMNID(u)&&(this.did="did:uport:"+u),u.match("^0x[0-9a-fA-F]{40}$")&&(this.did="did:ethr:"+u);else if(d){var y=f.keyFromPrivate(d),E=s.toEthereumAddress(y.getPublic("hex"));this.did="did:ethr:"+E}t(v||o({networks:p?(r=p,Object.keys(r).forEach(function(e){var t=r[e];if("object"!=typeof t)throw new Error("Network configuration object required");["registry","rpcUrl"].forEach(function(e){if(!t.hasOwnProperty(e))throw new Error("Malformed network config object, object must have '"+e+"' key specified.")})}),r):{}})),i(h||{}),n()};v.createIdentity=function(){var e=f.genKeyPair(),r=e.getPublic("hex"),t=e.getPrivate("hex");return{did:"did:ethr:"+s.toEthereumAddress(r),privateKey:t}},v.prototype.signJWT=function(e,r){return this.did&&this.signer?s.createJWT(e,{issuer:this.did,signer:this.signer,alg:this.did.match("^did:uport:")||a.isMNID(this.did)?"ES256K":"ES256K-R",expiresIn:r}):Promise.reject(new Error("No Signing Identity configured"))},v.prototype.createDisclosureRequest=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);var t={};if(e.requested&&(t.requested=e.requested),e.verified&&(t.verified=e.verified),e.claims&&(t.claims=e.claims),e.notifications&&(t.permissions=["notifications"]),e.callbackUrl&&(t.callback=e.callbackUrl),e.networkId&&(t.net=e.networkId),e.rpcUrl){if(!e.networkId)return Promise.reject(new Error("rpcUrl was specified but no networkId"));t.rpc=e.rpcUrl}if(e.vc&&(t.vc=e.vc),e.exp&&(t.exp=e.exp),e.accountType){if(!(["general","segregated","keypair","none"].indexOf(e.accountType)>=0))return Promise.reject(new Error("Unsupported accountType "+e.accountType));t.act=e.accountType}return this.signJWT(Object.assign({},t,{type:d.DISCLOSURE_REQUEST}),e.exp?void 0:r)},v.prototype.createVerification=function(e){return this.signJWT({sub:e.sub,claim:e.claim,exp:e.exp,vc:e.vc,callbackUrl:e.callbackUrl})},v.prototype.createVerificationSignatureRequest=function(e,r){return this.signJWT({unsignedClaim:e,sub:r.sub,riss:r.riss,aud:r.aud,vc:r.vc,callback:r.callbackUrl,type:d.VERIFICATION_SIGNATURE_REQUEST,rexp:r.rexp},r.expiresIn)},v.prototype.createTypedDataSignatureRequest=function(e,r){void 0===r&&(r={});var t=r.from,i=r.net,n=r.callback;try{for(var o=0,a=["types","primaryType","message","domain"];o<a.length;o+=1){var s=a[o];if(!e[s])throw new Error("Invalid EIP712 Request, must include '"+s+"'")}return Promise.resolve(this.signJWT({typedData:e,from:t,net:i,callback:n,type:d.TYPED_DATA_SIGNATURE_REQUEST}))}catch(e){return Promise.reject(e)}},v.prototype.createPersonalSignRequest=function(e,r){return void 0===r&&(r={}),this.signJWT({data:e,from:r.from,net:r.net,callback:r.callback,type:d.PERSONAL_SIGN_REQUEST})},v.prototype.createTxRequest=function(e,r){void 0===r&&(r={});var t=r.callbackUrl,i=r.exp;void 0===i&&(i=600);var n=r.networkId,o=r.label,a={};return t&&(a.callback=t),n&&(a.net=n),o&&(a.label=o),this.signJWT(Object.assign({},a,e,{type:d.ETH_TX_REQUEST}),i)},v.prototype.createDisclosureResponse=function(e,r){void 0===e&&(e={}),void 0===r&&(r=600);try{var t=this;function i(){return t.signJWT(Object.assign({},e,{type:d.DISCLOSURE_RESPONSE}),r)}var n=function(){if(e.req)return Promise.resolve(s.verifyJWT(e.req)).then(function(r){r.issuer&&(e.aud=r.issuer)})}();return n&&n.then?n.then(i):i()}catch(e){return Promise.reject(e)}},v.prototype.processDisclosurePayload=function(e){var r=e.doc,t=e.payload;try{var i=this,n=t.own;void 0===n&&(n={});var o=t.capabilities;void 0===o&&(o=[]);var c=t.nad,u=t.dad,d=t.iss,l=t.boxPub,p=t.verified,f=function(e,r){var t={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&-1===r.indexOf(i)&&(t[i]=e[i]);return t}(t,["own","capabilities","aud","req","iat","exp","type","nad","dad","iss","boxPub","verified"]),v=r.uportProfile;void 0===v&&(v={});var h=Object.assign({},{did:d,boxPub:l},n,v,f);u&&(h.deviceKey=u),c&&(h.mnid=c,h.address=a.decode(c).address),1===o.length&&(h.pushToken=o[0]);var y=function(){if(p){var e=[],r=p.map(function(r){return s.verifyJWT(r,{audience:i.did}).catch(function(){return e.push(r),Promise.resolve(void 0)})});return Promise.resolve(Promise.all(r)).then(function(r){var t=[];r.forEach(function(e){e&&t.push(Object.assign({},e.payload,{jwt:e.jwt}))}),h.verified=t,h.invalid=e})}}();return y&&y.then?y.then(function(){return h}):h}catch(e){return Promise.reject(e)}},v.prototype.authenticateDisclosureResponse=function(e,r){try{var t=this;return Promise.resolve(s.verifyJWT(e,{audience:t.did,callbackUrl:r,auth:!0})).then(function(e){var r=e.payload,i=e.doc;if(r.req)return Promise.resolve(s.verifyJWT(r.req,{audience:t.did})).then(function(e){var n=e.payload;if(n.type!==d.DISCLOSURE_REQUEST)throw new Error("Challenge payload type invalid: "+n.type);return t.processDisclosurePayload({payload:r,doc:i})});throw new Error("Challenge was not included in response")})}catch(e){return Promise.reject(e)}},v.prototype.verifyDisclosure=function(e){try{var r=this;return Promise.resolve(s.verifyJWT(e,{audience:r.did})).then(function(e){return r.processDisclosurePayload({payload:e.payload,doc:e.doc})})}catch(e){return Promise.reject(e)}},v.prototype.contract=function(e){var r=this;return p(function(e,t){return e.function&&(e.fn=e.function),delete e.function,r.createTxRequest(e,t)}.bind(this))(e)},e.SimpleSigner=s.SimpleSigner,e.Credentials=v,e.ContractFactory=p});
//# sourceMappingURL=index.umd.js.map
